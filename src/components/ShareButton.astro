---
import { Icon } from 'astro-icon/components';
---

<button class="copy-share-wrapper">
  <span class="copy-share-btn"><Icon name="octicon:link-16" /></span>
  <span class="toast">Copied!</span>
</button>

<script>
  document.addEventListener("click", async (e) => {
    const wrapper = e.target.closest(".copy-share-wrapper");

    if (!wrapper) return;
    
    const toast = wrapper.querySelector(".toast");

    try {
      const url = new URL(window.location.href);
      url.hash = "";
      const cleanUrl = url.toString();

      const text = `${document.title}\n${url.toString()}`;
      await navigator.clipboard.writeText(text);

      showToast(toast, "Copied!");
    } catch {
      showToast(toast, "Failed...");
    }
  });

  function showToast(toast, message) {
    toast.textContent = message;
    toast.classList.add("show");
    setTimeout(() => {
      toast.classList.remove("show");
    }, 2500);
  }
</script>

<style is:global>
  .copy-share-wrapper {
    background-color: transparent;
    position: relative;
    display: block;
    margin-left: auto;
    border: none;
  }
  .copy-share-btn {
    box-shadow: 2px 4px 12px rgba(0,0,0,0.2);

    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 1px solid #ddd;
    background-color: transparent;
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .copy-share-btn:hover {
    cursor: pointer;
    background: #f5f5f5;
  }
  .copy-share-btn svg {
    width: 24px;
    height: 24px;
  }

  @media (max-width: 640px) {
    .copy-share-btn {
      width: 40px;
      height: 40px;
    }
    .copy-share-btn svg {
      width: 20px;
      height: 20px;
    }
  }

  .toast {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(8px);

    background: rgba(235, 236, 237, 0.6);
    color: var(--fg);

    padding: 0.5rem 0.9rem;
    border-radius: 6px;
    font-size: 0.85rem;
    white-space: nowrap;

    opacity: 0;
    pointer-events: none;
    transition: 0.25s ease;
    z-index: 10;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(-6px);
  }
</style>